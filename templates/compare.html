{% extends "base.html" %}
{% block content %}

<div class="glass-card animate-fade-up" style="padding:26px;">

    <h2 style="margin-top:0; font-size:24px; font-weight:800; color:#061226;">
        Compare Localities
    </h2>

    <!-- Compare Form -->
    <form method="POST" class="compare-form">

        <div class="compare-row">
            <div class="compare-field">
                <label>Locality A</label>
                <select name="loc_a" class="compare-select" required>
                    <option value="">-- choose --</option>
                    {% for l in localities %}
                        <option value="{{ l }}" {% if loc_a == l %}selected{% endif %}>{{ l }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="compare-field">
                <label>Locality B</label>
                <select name="loc_b" class="compare-select" required>
                    <option value="">-- choose --</option>
                    {% for l in localities %}
                        <option value="{{ l }}" {% if loc_b == l %}selected{% endif %}>{{ l }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <button class="btn-primary compare-btn" type="submit" style="margin-top:10px;">
            Compare
        </button>

    </form>

    {% if error %}
        <p style="color:#d32f2f; font-weight:700; margin-top:10px;">{{ error }}</p>
    {% endif %}

    {% if stats_a and stats_b %}
    <hr style="margin:26px 0; border-color:rgba(0,0,0,0.05);">

    <!-- Comparison Summary -->
    <h3 style="font-size:20px; font-weight:800; margin-bottom:18px;">Comparison Summary</h3>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>{{ loc_a }}</th>
                    <th>{{ loc_b }}</th>
                </tr>
            </thead>

            <tbody>
                <tr>
                    <td>Avg Rent</td>
                    <td>₹{{ stats_a.avg_rent | int }}</td>
                    <td>₹{{ stats_b.avg_rent | int }}</td>
                </tr>
                <tr>
                    <td>Avg Fair Rent</td>
                    <td>₹{{ stats_a.avg_pred_rent | int }}</td>
                    <td>₹{{ stats_b.avg_pred_rent | int }}</td>
                </tr>
                <tr>
                    <td>Avg Size (sqft)</td>
                    <td>{{ stats_a.avg_size | int }}</td>
                    <td>{{ stats_b.avg_size | int }}</td>
                </tr>
                <tr>
                    <td>Avg BHK</td>
                    <td>{{ stats_a.avg_bhk | round(1) }}</td>
                    <td>{{ stats_b.avg_bhk | round(1) }}</td>
                </tr>
                <tr>
                    <td>Value Score</td>
                    <td>{{ stats_a.value_score | round(2) }}</td>
                    <td>{{ stats_b.value_score | round(2) }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <hr style="margin:26px 0; border-color:rgba(0,0,0,0.05);">

    <!-- Rent Chart -->
    <h3 style="font-size:20px; font-weight:800; margin-bottom:14px;">
        Rent Comparison Chart
    </h3>

    <div id="compareChart" style="height:430px; border-radius:14px;"></div>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        var labels = {{ chart_labels | safe }};
        var listedVals = {{ listed_values | safe }};
        var fairVals = {{ fair_values | safe }};

        var data = [
            {
                x: labels,
                y: listedVals,
                type: 'bar',
                name: "Avg Listed Rent",
                marker: { color: 'rgba(123,47,247,0.65)' }
            },
            {
                x: labels,
                y: fairVals,
                type: 'bar',
                name: "Avg Fair Rent",
                marker: { color: 'rgba(10,179,255,0.65)' }
            }
        ];

        Plotly.newPlot("compareChart", data, {
            title: "",
            barmode: 'group',
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            margin: { t: 20 }
        });
    </script>

    {% endif %}
</div>

{% endblock %}
